<script>

const habits = 10;
const days = 28;

const tbody = document.querySelector("#habitTable tbody");

/* CREATE TABLE */

for(let d=1; d<=days; d++){

    const tr = document.createElement("tr");
    let html = `<td>${d}</td>`;

    for(let h=1; h<=habits; h++){
        html += `<td>
        <input type="checkbox" onchange="updateChart(${d},${h},this)">
        </td>`;
    }

    html += `<td id="p${d}">0%</td>`;
    tr.innerHTML = html;
    tbody.appendChild(tr);
}

/* COLORS FOR EACH HABIT */

const colors = [
"#ff4d6d","#4cc9f0","#ffd60a","#80ed99","#c77dff",
"#ff9f1c","#00f5d4","#f72585","#90dbf4","#b8f2e6"
];

/* DATASET CREATE */

const datasets = [];

for(let i=1;i<=habits;i++){
    datasets.push({
        label: "Habit " + i,
        data: [],
        borderColor: colors[i-1],
        backgroundColor: colors[i-1],
        showLine: false,   // IMPORTANT âŒ no connecting line
        pointRadius: 6
    });
}

/* CHART */

const chart = new Chart(
document.getElementById('dailyChart'),
{
    type:'scatter',
    data:{ datasets },
    options:{
        scales:{
            x:{
                type:'linear',
                min:1,
                max:days,
                title:{display:true,text:'Day'}
            },
            y:{
                min:1,
                max:10,
                ticks:{ stepSize:1 },
                title:{display:true,text:'Habit Number'}
            }
        }
    }
});

/* UPDATE FUNCTION */

function updateChart(day, habit, box){

    const ds = datasets[habit-1];

    if(box.checked){

        ds.data.push({x:day, y:habit});

    }else{

        ds.data = ds.data.filter(p => !(p.x===day && p.y===habit));
    }

    chart.update();

    updatePercentage(day);
}

/* DAILY % */

function updatePercentage(day){

    const row = document.querySelectorAll("#habitTable tbody tr")[day-1];
    const checks = row.querySelectorAll("input");

    let done = 0;
    checks.forEach(c=>{ if(c.checked) done++; });

    const percent = Math.round((done/habits)*100);

    document.getElementById("p"+day).innerText = percent + "%";
}

</script>
